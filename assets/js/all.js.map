{"version":3,"sources":["all.js"],"names":["api_path","token","baseUrl","adminOrder_path","tokenObj","headers","orderList","document","querySelector","orderTable","orderData","addEventListener","deleteOrder","isPaid","init","getOrderData","axios","get","then","res","data","orders","renderOrderList","renderChart","err","errData","response","status","console","log","message","str","forEach","item","listStr","products","title","date","Date","createdAt","toLocaleDateString","id","user","name","tel","address","email","paid","innerHTML","e","targetJs","target","dataset","js","preventDefault","obj","put","ary","totalPrice","price","quantity","aryCheck","some","product","length","revenue","push","newAry","sort","a","b","otherObj","chartData","index","chartAry","colorData","colorObj","chart","c3","generate","bindto","columns","type","colors","size","height","width"],"mappings":"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","file":"all.js","sourcesContent":["// 後台\n// API\nconst api_path = 'calon';\nconst token = 'zqvqaKYuHkZmVjBBRE9EepP5KF13';\nconst baseUrl = 'https://livejs-api.hexschool.io';\nconst adminOrder_path = `api/livejs/v1/admin/${api_path}/orders`;\nconst tokenObj = {\n  headers: {\n    'Authorization': token\n  }\n};\n\n// DOM\nconst orderList = document.querySelector('[data-js=\"orderList\"]');\nconst orderTable = document.querySelector('.orderTable');\n\n// data\nlet orderData;\n\n// event\norderTable.addEventListener('click', deleteOrder);\norderTable.addEventListener('click', isPaid);\n\ninit();\n\nfunction init() {\n  getOrderData();\n};\n\nfunction getOrderData() {\n  axios.get(`${baseUrl}/${adminOrder_path}`, tokenObj).then(function (res) {\n    orderData = res.data.orders;\n    renderOrderList();\n    renderChart();\n  }).catch(function (err) {\n    let errData = err.response.data;\n    if (!errData.status) {\n      console.log(errData.message);\n    };\n  });\n};\n\nfunction renderOrderList() {\n  let str = '';\n  orderData.forEach(function (item) {\n    let listStr = ''\n    item.products.forEach(function (item) {\n      listStr += `<li>${item.title}</li>`\n    });\n    let date = new Date(item.createdAt * 1000).toLocaleDateString();\n    str += `\n      <tr class=\"border-b\">\n        <td class=\"p-1.5 border-r\">${item.id}</td>\n        <td class=\"p-1.5 border-r\">\n          <ul>\n            <li>${item.user.name}</li>\n            <li>${item.user.tel}</li>\n          </ul>\n        </td>\n        <td class=\"p-1.5 border-r\">${item.user.address}</td>\n        <td class=\"p-1.5 border-r\">${item.user.email}</td>\n        <td class=\"p-1.5 border-r\">\n          <ul>${listStr}</ul>\n        </td>\n        <td class=\"p-1.5 border-r text-center\">${date}</td>\n        <td class=\"p-1.5 border-r text-center\">\n          <a class=\"text-info underline\" href=\"#\" data-id=\"${item.id}\" data-js=\"paidBtn\">${item.paid ? '已處理' : '未處理'}</a>\n        </td>\n        <td class=\"p-1.5 text-center\">\n          <button class=\"text-white bg-danger hover:opacity-70 rounded py-1.5 px-2.5\" data-js=\"deleteOrderBtn\" data-id=\"${item.id}\">刪除</button>\n        </td>\n      </tr>\n  `\n  });\n  orderList.innerHTML = str;\n};\n\nfunction deleteOrder(e) {\n  let targetJs = e.target.dataset.js;\n  if (targetJs !== 'deleteOrderBtn' && targetJs !== 'deleteAllOrderBtn') {\n    return\n  } else if (targetJs === 'deleteAllOrderBtn') {\n    axios.delete(`${baseUrl}/${adminOrder_path}`, tokenObj).then(function (res) {\n      getOrderData();\n    }).catch(function (err) {\n      let errData = err.response.data;\n      if (!errData.status) {\n        console.log(errData.message);\n      };\n    });\n  } else if (targetJs === 'deleteOrderBtn') {\n    let id = e.target.dataset.id;\n    axios.delete(`${baseUrl}/${adminOrder_path}/${id}`, tokenObj).then(function (res) {\n      getOrderData();\n    }).catch(function (err) {\n      let errData = err.response.data;\n      if (!errData.status) {\n        console.log(errData.message);\n      };\n    });\n  };\n};\n\nfunction isPaid(e) {\n  e.preventDefault();\n  if (e.target.dataset.js !== 'paidBtn') { return }\n  let id = e.target.dataset.id;\n  let obj = {\n    \"data\": {\n      \"id\": id,\n      \"paid\": true\n    }\n  };\n  axios.put(`${baseUrl}/${adminOrder_path}`, obj, tokenObj).then(function (res) {\n    console.log(res);\n    getOrderData();\n  }).catch(function (err) {\n    let errData = err.response.data;\n    if (!errData.status) {\n      console.log(errData.message);\n    };\n  });\n};\n\nfunction renderChart() {\n  let ary = [];\n\n  orderData.forEach(function (item) {\n    item.products.forEach(function (item) {\n      let title = item.title;\n      let totalPrice = item.price * item.quantity;\n      let aryCheck = ary.some(function (product) { return product.title == title });\n\n      if (ary.length === 0 || !aryCheck) {\n        let obj = {};\n        obj.title = title;\n        obj.revenue = totalPrice;\n        ary.push(obj);\n      } else {\n        ary.forEach(function (item) {\n          if (item.title === title) {\n            item.revenue += totalPrice;\n          };\n        });\n      };\n    });\n  });\n\n  let newAry = ary.sort(function (a, b) {\n    if (a.revenue > b.revenue) return -1; // true 時後面的數放在前面\n    if (a.revenue < b.revenue) return 1; // true 時前面得數放在前面\n  });\n\n  let otherObj = {\n    title: '其他',\n    revenue: 0\n  };\n\n\n  let chartData = [];\n  newAry.forEach(function (item, index) {\n    let chartAry = [];\n    if (index < 3) {\n      chartAry.push(item.title, item.revenue);\n      chartData.push(chartAry);\n    } else {\n      otherObj.revenue += item.revenue;\n    };\n  });\n\n  // 根據順序上圖表顏色\n  chartData.push([otherObj.title, otherObj.revenue]);\n  chartData = chartData.sort(function (a, b) {\n    if (a[1] > b[1]) return -1;\n    if (a[1] < b[1]) return 1;\n  });\n\n  const colorData = ['#301E5F', '#5434A7', '#9D7FEA', '#DACBFF'];\n  let colorObj = {};\n  chartData.forEach(function (item, index) {\n    colorObj[item[0]] = colorData[index];\n  });\n\n  let chart = c3.generate({\n    bindto: '#productRevenue',\n    data: {\n      columns: chartData,\n      type: 'pie',\n      colors: colorObj\n    },\n    size: {\n      height: 400,\n      width: 400\n    },\n  });\n}\n\n\n"]}